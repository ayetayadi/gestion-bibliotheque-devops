<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ressources | BiblioNet</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>

<body>

<div th:replace="layout/header :: header"></div>
<div th:replace="layout/sidebar :: sidebar"></div>

<main class="content">

    <!-- ================= TITRE + BOUTON ================= -->
    <div class="page-header">
        <div>
            <h2>üìö Liste des ressources</h2>
            <p class="text-muted">Catalogue de votre biblioth√®que</p>
        </div>

        <a class="btn btn-primary" th:href="@{/ressources/new}">
            ‚ûï Ajouter une ressource
        </a>
    </div>

 <!-- ==================== BARRE DE FILTRES ==================== -->
<form method="get" action="/ressources" class="filter-bar">

    <input type="text" name="keyword"
           placeholder="Rechercher un titre ou auteur..."
           th:value="${keyword}">

<select name="biblioId" th:if="${currentUser.role.name() == 'ADMIN'}">
    <option value="">Toutes les biblioth√®ques</option>

    <option th:each="b : ${bibliotheques}"
            th:value="${b.id}"
            th:selected="${b.id == selectedBiblio}"
            th:text="${b.nom}">
    </option>
</select>
    <select name="categorie">
        <option value="">Cat√©gorie</option>
        <option th:each="c : ${categories}"
                th:value="${c}"
                th:selected="${c == selectedCategorie}"
                th:text="${c}">
        </option>
    </select>

    <select name="typeRessource">
        <option value="">Type</option>
        <option th:each="t : ${typesRessource}"
                th:value="${t}"
                th:selected="${t == selectedType}"
                th:text="${t}">
        </option>
    </select>

    <button type="submit" class="btn-primary">üîç Rechercher</button>

</form>

    <!-- ==================== LISTE DES RESSOURCES ==================== -->
    <div class="resource-list">

        <div class="resource-card" th:each="r : ${ressources}" th:if="${r != null}">

            <!-- IMAGE -->
            <div class="resource-img">
                <img th:if="${r.cheminCouverture != null}"
                     th:src="${#strings.startsWith(r.cheminCouverture, 'http') 
                              ? r.cheminCouverture 
                              : '/uploads/covers/' + r.cheminCouverture}"
                     alt="Couverture">

                <div th:if="${r.cheminCouverture == null}" class="no-cover">üìò</div>
            </div>

            <!-- INFO -->
            <div class="resource-content">

                <div class="resource-header">
                    <h3 th:text="${r.titre}"></h3>
                    <span class="badge badge-type" th:text="${r.typeRessource}"></span>
                </div>

                <p class="author" th:text="'Auteur : ' + ${r.auteur}"></p>

                <p>
                    <strong>Cat√©gorie :</strong>
                    <span th:text="${r.categorie}"></span>
                </p>

                <p>
                    <strong>Biblioth√®que :</strong>
                    <span th:text="${r.bibliotheque.nom}"></span>
                </p>

                <!-- STOCK -->
                <div class="stock-box" th:with="s=${stocks[r.id]}">
                    <div class="stock-row">
                        <span class="label">Disponible :</span>
                        <span th:text="${s.quantiteDisponible}"></span>
                        <span>/</span>
                        <span th:text="${s.quantiteTotale}"></span>
                    </div>

                    <div class="stock-row">
                        <span class="label">Total :</span>
                        <span th:text="${s.quantiteTotale}"></span>
                    </div>
                </div>

                <!-- ACTIONS -->
                <div class="resource-actions">
                    <a th:href="@{'/ressources/edit/' + ${r.id}}" class="btn btn-secondary">
                        Modifier
                    </a>
                </div>

            </div>
        </div>
    </div>

    <!-- PAGINATION -->
    <div th:replace="fragments/pagination :: pagination(${page}, ${baseUrl})"></div>

</main>

<div th:replace="layout/footer :: footer"></div>

</body>
</html>
